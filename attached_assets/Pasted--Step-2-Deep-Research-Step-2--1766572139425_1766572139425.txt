# 追加要件：Step 2における「Deep Research エージェント」の実装

Step 2（事業仮説の生成）の実装において、単に検索機能を有効化するだけでなく、以下の**自律型リサーチサイクル（Deep Research Logic）**をコードレベルで実装してください。

## 1. 概念定義 Step 2の処理を「1回のプロンプト送信」で終わらせず、以下の4フェーズを循環するエージェント・ワークフローとして構築してください。

Planning (計画): ターゲットと技術資産を分析し、調査すべき論点を特定する。

Exploring (探索): 論点ごとに複数の検索クエリを発行し、広範囲・多角的に情報を収集する。

Reasoning (推論): 得られた情報が十分か判断し、不足があれば追加調査を行う（反復）。

Synthesizing (統合): 収集した全情報を統合し、指定フォーマット（Wordプロンプト）に従ってレポートを出力する。

## 2. 実装ロジック (Python Backend Flow)

Gemini APIの tools='google_search_retrieval' を使用しつつ、バックエンドで以下のフロー制御を行ってください。

Phase 1: Research Planning

Action: LLMに対し、「ターゲット指定」と「技術資産」を入力として与え、**「事業仮説を構築するために調査すべき5つの重要カテゴリ（市場動向、競合技術、規制、顧客課題、サプライチェーンなど）と、それぞれの検索クエリ案」**を出力させてください（JSON形式推奨）。

Phase 2: Deep Exploration (Parallel Search)

Action: Phase 1で策定されたクエリに基づき、Gemini APIを通じて検索を実行します。

Requirement: ここでは「1回の検索」で満足せず、各カテゴリについて**深掘り（Drill-down）**を行うようプロンプトで指示してください。

指示例: 「学術的な裏付け(Academic)、市場の数値(Market Size)、競合の具体名(Competitors)が見つかるまで検索を行ってください」

Phase 3: Reasoning & Iteration (The Check Loop)

Action: 検索結果の内容をLLMに一度評価させます。

Logic:

プロンプト: 「現在の検索結果で、事業仮説レポート（添付のStep 2プロンプトの要件）を十分に記述できるファクトが揃っていますか？ 不足している情報（Missing Information）があれば指摘してください」

分岐処理: もし「不足あり」と判断された場合、不足分を補うための追加検索（Follow-up Search）を自動実行してください。（最大ループ回数: 2回程度に制限）

Phase 4: Synthesizing (Report Generation)

Action: 最終的に集まった「全検索結果（コンテキスト）」と「元の入力ファイル」を、添付ファイルのシステム指令（2_提案_複数仮説版_Gemini用.docx）に投入し、最終的な事業仮説レポートを生成してください。

Constraint: レポート内の各主張には、必ず検索結果に基づく**出典（引用元URL）**を明記させること。

## 3. プロンプトエンジニアリングへの反映

Step 2の実行時にGeminiに送るシステムプロンプト（添付Wordファイルの内容）の冒頭に、以下のメタインストラクションを動的に追加挿入してください。

【Deep Research Mode: Active】 あなたは自律的なリサーチ・エージェントです。ユーザーの質問に即答するのではなく、以下のステップを踏んでください：

Think: まず「何を知る必要があるか」を考え、サブタスクに分解する。

Search: サブタスクごとに検索ツールを使用し、Web、ニュース、論文、特許情報などから多角的に情報を集める。

Reflect: 集めた情報に矛盾や不足がないか自己評価し、必要なら追加検索を行う。

Write: 集めた証拠（Evidence）のみに基づいて、論理的かつ具体的な仮説レポートを作成する。

※各段落には必ず情報源への出典リンク `` を付与すること。推測だけで事実を捏造することは厳禁とする。

## 4. UI上の表現 この処理は時間がかかるため、フロントエンド（Streamlit等）上では、現在のステータスをリアルタイムで表示してください。

表示例:

Running: "Planning research strategy..."

Running: "Searching web for 'EV Market Trends 2025'..."

Running: "Analyzing gathered data..."

Running: "Synthesizing final report..."